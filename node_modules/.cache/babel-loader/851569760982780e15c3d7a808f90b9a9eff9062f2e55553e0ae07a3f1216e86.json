{"ast":null,"code":"import { CosmosClient } from \"@azure/cosmos\";\nconst USE_LOCAL_STORAGE = process.env.NODE_ENV === 'development';\nclass CosmosDBService {\n  constructor() {\n    this.endpoint = process.env.REACT_APP_COSMOS_ENDPOINT;\n    this.key = process.env.REACT_APP_COSMOS_KEY;\n    this.databaseId = process.env.REACT_APP_COSMOS_DATABASE_ID || \"azure_learning_games\";\n    this.containerId = process.env.REACT_APP_COSMOS_CONTAINER_ID || \"game_scores\";\n    this.isConfigured = this.validateConfig();\n    if (this.isConfigured) {\n      try {\n        this.client = new CosmosClient({\n          endpoint: this.endpoint,\n          key: this.key\n        });\n        this.database = this.client.database(this.databaseId);\n        this.container = this.database.container(this.containerId);\n        console.log(\"CosmosDB service initialized successfully\");\n      } catch (error) {\n        console.error(\"Failed to initialize CosmosDB client:\", error);\n        this.isConfigured = false;\n      }\n    } else {\n      console.warn(\"CosmosDB service not properly configured - saving scores will be disabled\");\n    }\n  }\n  validateConfig() {\n    // Check if we have valid configuration\n    if (!this.endpoint || this.endpoint === \"your_cosmos_db_endpoint\" || !this.endpoint.startsWith(\"https://\") || !this.key || this.key === \"your_cosmos_db_key\") {\n      return false;\n    }\n    return true;\n  }\n  async saveGameScore(nickname, gameType, score, metadata = {}) {\n    if (USE_LOCAL_STORAGE) {\n      console.log(`[LocalStorage] Saving score: ${nickname}, ${gameType}, ${score}`);\n      const timestamp = new Date().toISOString();\n      const scoreData = {\n        id: `${nickname}_${gameType}_${timestamp}`,\n        nickname,\n        gameType,\n        score,\n        timestamp,\n        ...metadata\n      };\n\n      // Get existing scores\n      const existingScores = JSON.parse(localStorage.getItem('gameScores') || '[]');\n      existingScores.push(scoreData);\n      localStorage.setItem('gameScores', JSON.stringify(existingScores));\n      return scoreData;\n    }\n    if (!this.isConfigured) {\n      console.log(`[Mock CosmosDB] Would save score: ${nickname}, ${gameType}, ${score}`);\n      return {\n        id: \"mock-id\",\n        success: false,\n        message: \"CosmosDB not configured\"\n      };\n    }\n    try {\n      const timestamp = new Date().toISOString();\n      const scoreData = {\n        id: `${nickname}_${gameType}_${timestamp}`,\n        nickname,\n        gameType,\n        score,\n        timestamp,\n        ...metadata\n      };\n      const {\n        resource: createdItem\n      } = await this.container.items.create(scoreData);\n      console.log(`Successfully saved score for ${nickname} in ${gameType}`);\n      return createdItem;\n    } catch (error) {\n      console.error(\"Error saving score to CosmosDB:\", error);\n      // Return a mock response so the game continues\n      return {\n        id: \"error-id\",\n        success: false,\n        error: error.message\n      };\n    }\n  }\n  async getLeaderboard(gameType, limit = 10) {\n    if (USE_LOCAL_STORAGE) {\n      console.log(`[LocalStorage] Getting leaderboard for: ${gameType}`);\n      const allScores = JSON.parse(localStorage.getItem('gameScores') || '[]');\n      return allScores.filter(score => score.gameType === gameType).sort((a, b) => b.score - a.score).slice(0, limit);\n    }\n    if (!this.isConfigured) {\n      console.log(`[Mock CosmosDB] Would get leaderboard for: ${gameType}`);\n      return [{\n        nickname: \"Example\",\n        score: 100,\n        timestamp: new Date().toISOString()\n      }];\n    }\n    try {\n      const querySpec = {\n        query: \"SELECT * FROM c WHERE c.gameType = @gameType ORDER BY c.score DESC OFFSET 0 LIMIT @limit\",\n        parameters: [{\n          name: \"@gameType\",\n          value: gameType\n        }, {\n          name: \"@limit\",\n          value: limit\n        }]\n      };\n      const {\n        resources\n      } = await this.container.items.query(querySpec).fetchAll();\n      return resources;\n    } catch (error) {\n      console.error(\"Error retrieving leaderboard from CosmosDB:\", error);\n      // Return an empty array so the game can continue\n      return [];\n    }\n  }\n}\nexport default new CosmosDBService();","map":{"version":3,"names":["CosmosClient","USE_LOCAL_STORAGE","process","env","NODE_ENV","CosmosDBService","constructor","endpoint","REACT_APP_COSMOS_ENDPOINT","key","REACT_APP_COSMOS_KEY","databaseId","REACT_APP_COSMOS_DATABASE_ID","containerId","REACT_APP_COSMOS_CONTAINER_ID","isConfigured","validateConfig","client","database","container","console","log","error","warn","startsWith","saveGameScore","nickname","gameType","score","metadata","timestamp","Date","toISOString","scoreData","id","existingScores","JSON","parse","localStorage","getItem","push","setItem","stringify","success","message","resource","createdItem","items","create","getLeaderboard","limit","allScores","filter","sort","a","b","slice","querySpec","query","parameters","name","value","resources","fetchAll"],"sources":["/Users/eimis/test-server/Azure Hackthons/azure-cloud-architecture-game /src/services/CosmosDBService.js"],"sourcesContent":["import { CosmosClient } from \"@azure/cosmos\";\n\nconst USE_LOCAL_STORAGE = process.env.NODE_ENV === 'development';\n\nclass CosmosDBService {\n    constructor() {\n        this.endpoint = process.env.REACT_APP_COSMOS_ENDPOINT;\n        this.key = process.env.REACT_APP_COSMOS_KEY;\n        this.databaseId = process.env.REACT_APP_COSMOS_DATABASE_ID || \"azure_learning_games\";\n        this.containerId = process.env.REACT_APP_COSMOS_CONTAINER_ID || \"game_scores\";\n        \n        this.isConfigured = this.validateConfig();\n        \n        if (this.isConfigured) {\n            try {\n                this.client = new CosmosClient({ endpoint: this.endpoint, key: this.key });\n                this.database = this.client.database(this.databaseId);\n                this.container = this.database.container(this.containerId);\n                console.log(\"CosmosDB service initialized successfully\");\n            } catch (error) {\n                console.error(\"Failed to initialize CosmosDB client:\", error);\n                this.isConfigured = false;\n            }\n        } else {\n            console.warn(\"CosmosDB service not properly configured - saving scores will be disabled\");\n        }\n    }\n    \n    validateConfig() {\n        // Check if we have valid configuration\n        if (!this.endpoint || this.endpoint === \"your_cosmos_db_endpoint\" || \n            !this.endpoint.startsWith(\"https://\") || \n            !this.key || this.key === \"your_cosmos_db_key\") {\n            return false;\n        }\n        return true;\n    }\n\n    async saveGameScore(nickname, gameType, score, metadata = {}) {\n        if (USE_LOCAL_STORAGE) {\n            console.log(`[LocalStorage] Saving score: ${nickname}, ${gameType}, ${score}`);\n            const timestamp = new Date().toISOString();\n            const scoreData = {\n                id: `${nickname}_${gameType}_${timestamp}`,\n                nickname,\n                gameType,\n                score,\n                timestamp,\n                ...metadata\n            };\n            \n            // Get existing scores\n            const existingScores = JSON.parse(localStorage.getItem('gameScores') || '[]');\n            existingScores.push(scoreData);\n            localStorage.setItem('gameScores', JSON.stringify(existingScores));\n            \n            return scoreData;\n        }\n        \n        if (!this.isConfigured) {\n            console.log(`[Mock CosmosDB] Would save score: ${nickname}, ${gameType}, ${score}`);\n            return { id: \"mock-id\", success: false, message: \"CosmosDB not configured\" };\n        }\n        \n        try {\n            const timestamp = new Date().toISOString();\n            const scoreData = {\n                id: `${nickname}_${gameType}_${timestamp}`,\n                nickname,\n                gameType,\n                score,\n                timestamp,\n                ...metadata\n            };\n            \n            const { resource: createdItem } = await this.container.items.create(scoreData);\n            console.log(`Successfully saved score for ${nickname} in ${gameType}`);\n            return createdItem;\n        } catch (error) {\n            console.error(\"Error saving score to CosmosDB:\", error);\n            // Return a mock response so the game continues\n            return { id: \"error-id\", success: false, error: error.message };\n        }\n    }\n\n    async getLeaderboard(gameType, limit = 10) {\n        if (USE_LOCAL_STORAGE) {\n            console.log(`[LocalStorage] Getting leaderboard for: ${gameType}`);\n            const allScores = JSON.parse(localStorage.getItem('gameScores') || '[]');\n            return allScores\n                .filter(score => score.gameType === gameType)\n                .sort((a, b) => b.score - a.score)\n                .slice(0, limit);\n        }\n        \n        if (!this.isConfigured) {\n            console.log(`[Mock CosmosDB] Would get leaderboard for: ${gameType}`);\n            return [{ nickname: \"Example\", score: 100, timestamp: new Date().toISOString() }];\n        }\n        \n        try {\n            const querySpec = {\n                query: \"SELECT * FROM c WHERE c.gameType = @gameType ORDER BY c.score DESC OFFSET 0 LIMIT @limit\",\n                parameters: [\n                    { name: \"@gameType\", value: gameType },\n                    { name: \"@limit\", value: limit }\n                ]\n            };\n            \n            const { resources } = await this.container.items.query(querySpec).fetchAll();\n            return resources;\n        } catch (error) {\n            console.error(\"Error retrieving leaderboard from CosmosDB:\", error);\n            // Return an empty array so the game can continue\n            return [];\n        }\n    }\n}\n\nexport default new CosmosDBService(); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}